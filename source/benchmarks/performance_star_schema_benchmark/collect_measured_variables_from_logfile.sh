#!/bin/bash
#set -x
SCRIPT_DIR=$(dirname "$(readlink -f "$0")")

#####################################################################
#External code start
#some util code for floating point math, taken from http://www.linuxjournal.com/content/floating-point-math-bash
# Default scale used by float functions.

float_scale=3


#####################################################################
# Evaluate a floating point number expression.

function float_eval()
{
    local stat=0
    local result=0.0
    if [[ $# -gt 0 ]]; then
        result=$(echo "scale=$float_scale; $*" | bc -q 2>/dev/null | sed 's/^\./0./')
        stat=$?
        #result=$(echo "($result+0.5)/1" | bc -q)
        #result=$(echo "$float" | awk '{print int($1+0.5)}')
        # $(echo "$result" | awk '{print int($1+0.5)}')

        if [[ $stat -eq 0  &&  -z "$result" ]]; then stat=1; fi
    fi
    echo $result
    return $stat
}
#External code end
#####################################################################

if [ ! -e "cogadb_ssb_measurement.log" ]; then
    echo "Error! Could not find file 'cogadb_ssb_measurement.log' in directory '$PWD'!"
    exit -1

fi

		#extract measured variables
		NUMBER_OF_EXECUTED_GPU_OPERATORS=`cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_GPU_OPERATORS" | awk '{print $2}'` 
		NUMBER_OF_ABORTED_GPU_OPERATORS=`cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_GPU_OPERATORS" | awk '{print $2}'`
		
		if [ -z $NUMBER_OF_EXECUTED_GPU_OPERATORS ];then
		    NUMBER_OF_EXECUTED_GPU_OPERATORS=0
		fi
		if [ -z $NUMBER_OF_ABORTED_GPU_OPERATORS ];then
		    NUMBER_OF_ABORTED_GPU_OPERATORS=0
		fi
		
NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_GPU_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_GPU_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS" | awk '{print $2}')
NUMBER_OF_EXECUTED_SELECTION_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_EXECUTED_SELECTION_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_Fetch_Join_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_Fetch_Join_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_GPU_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_GPU_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS" | awk '{print $2}')
NUMBER_OF_ABORTED_SELECTION_OPERATORS=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_ABORTED_SELECTION_OPERATORS" | awk '{print $2}')


		
if [ -z $NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS ]; then
    NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS ]; then
    NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS ]; then
    NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS ]; then
    NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS ]; then
    NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS ]; then
    NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS ]; then
    NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS ]; then
    NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_GPU_OPERATORS ]; then
    NUMBER_OF_EXECUTED_GPU_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS ]; then
    NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS ]; then
    NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS=0
fi
if [ -z $NUMBER_OF_EXECUTED_SELECTION_OPERATORS ]; then
    NUMBER_OF_EXECUTED_SELECTION_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS ]; then
    NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS ]; then
    NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS ]; then
    NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS ]; then
    NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS ]; then
    NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS ]; then
    NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_Fetch_Join_OPERATORS ]; then
    NUMBER_OF_ABORTED_Fetch_Join_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS ]; then
    NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_GPU_OPERATORS ]; then
    NUMBER_OF_ABORTED_GPU_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS ]; then
    NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS ]; then
    NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS=0
fi
if [ -z $NUMBER_OF_ABORTED_SELECTION_OPERATORS ]; then
    NUMBER_OF_ABORTED_SELECTION_OPERATORS=0
fi


BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC" | awk '{print $2}')
BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC" | awk '{print $2}')
COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC" | awk '{print $2}')
COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC" | awk '{print $2}')
JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN" | awk '{print $2}')
NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL=$(cat "cogadb_ssb_measurement.log" | grep "NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL" | awk '{print $2}')
POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC" | awk '{print $2}')
POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC" | awk '{print $2}')
TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC" | awk '{print $2}')
TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC=$(cat "cogadb_ssb_measurement.log" | grep "TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC" | awk '{print $2}')
if [ -z $BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC ]; then
    BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC=0
fi
if [ -z $BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC ]; then
    BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC=0
fi
if [ -z $COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC ]; then
    COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC=0
fi
if [ -z $COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC ]; then
    COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC=0
fi
if [ -z $JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC ]; then
    JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP ]; then
    NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST ]; then
    NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL ]; then
    NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP ]; then
    NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX ]; then
    NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST ]; then
    NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN ]; then
    NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN ]; then
    NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN=0
fi
if [ -z $NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL ]; then
    NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL=0
fi
if [ -z $POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC ]; then
    POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC=0
fi
if [ -z $POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC ]; then
    POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC=0
fi
if [ -z $TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC ]; then
    TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC=0
fi
if [ -z $TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC ]; then
    TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC=0
fi


#TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC
#TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC
#POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC
#POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC
#BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC
#BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC
#COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC
#COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC
#JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC

		echo -e "$TOTAL_COPY_TIME_HOST_TO_DEVICE_IN_SEC\n$TOTAL_COPY_TIME_DEVICE_TO_HOST_IN_SEC\n$POSITIONLIST_COPY_TIME_HOST_TO_DEVICE_IN_SEC\n$POSITIONLIST_COPY_TIME_DEVICE_TO_HOST_IN_SEC\n$BITMAP_COPY_TIME_HOST_TO_DEVICE_IN_SEC\n$BITMAP_COPY_TIME_DEVICE_TO_HOST_IN_SEC\n$COLUMN_COPY_TIME_HOST_TO_DEVICE_IN_SEC\n$COLUMN_COPY_TIME_DEVICE_TO_HOST_IN_SEC\n$JOIN_INDEXES_COPY_TIME_HOST_TO_DEVICE_IN_SEC" > data_transfer_times_over_pcie_bus.txt 
		
		for i in {0..8}; do echo $i; done > linenumbers
		paste linenumbers data_transfer_times_over_pcie_bus.txt  > data_transfer_times_over_pcie_bus.csv

#NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL
#NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL
#NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST
#NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST
#NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP
#NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP
#NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN
#NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN
#NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX

		echo -e "$NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_TOTAL\n$NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_TOTAL\n$NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_POSITIONLIST\n$NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_POSITIONLIST\n$NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_BITMAP\n$NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_BITMAP\n$NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_COLUMN\n$NUMBER_OF_COPY_OPERATIONS_DEVICE_TO_HOST_COLUMN\n$NUMBER_OF_COPY_OPERATIONS_HOST_TO_DEVICE_JOIN_INDEX" > number_of_data_transfer_operations_over_pcie_bus.txt
		
		for i in {0..8}; do echo $i; done > linenumbers
		paste linenumbers number_of_data_transfer_operations_over_pcie_bus.txt  > number_of_data_transfer_operations_over_pcie_bus.csv

		#write header of CSV file
		echo -e "#NUMBER_OF_ABORTED_GPU_OPERATORS\tNUMBER_OF_EXECUTED_GPU_OPERATORS\tNUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS\tNUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS\tNUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS\tNUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS\tNUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\tNUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\tNUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\tNUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\tNUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS\tNUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS\tNUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS\tNUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS\tNUMBER_OF_ABORTED_Fetch_Join_OPERATORS\tNUMBER_OF_EXECUTED_Fetch_Join_OPERATORS\tNUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS\tNUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS\tNUMBER_OF_ABORTED_GPU_OPERATORS\tNUMBER_OF_EXECUTED_GPU_OPERATORS\tNUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS\tNUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS\tNUMBER_OF_ABORTED_PositionList_Operator_OPERATORS\tNUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS\tNUMBER_OF_ABORTED_SELECTION_OPERATORS\tNUMBER_OF_EXECUTED_SELECTION_OPERATORS" > number_of_aborted_gpu_operators.csv
		#write data of CSV file
		echo -e "$NUMBER_OF_ABORTED_GPU_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_OPERATORS\t$NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS\t$NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS\t$NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS\t$NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS\t$NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\t$NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\t$NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\t$NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\t$NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS\t$NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS\t$NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS\t$NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS\t$NUMBER_OF_ABORTED_Fetch_Join_OPERATORS\t$NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS\t$NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS\t$NUMBER_OF_ABORTED_GPU_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_OPERATORS\t$NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS\t$NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS\t$NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS\t$NUMBER_OF_ABORTED_SELECTION_OPERATORS\t$NUMBER_OF_EXECUTED_SELECTION_OPERATORS" >> number_of_aborted_gpu_operators.csv
		#for plotting of all heuristics, we need to store our measurements column wise
		echo -e "$NUMBER_OF_ABORTED_GPU_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_OPERATORS\n$NUMBER_OF_ABORTED_Bitmap_Operator_OPERATORS\t$NUMBER_OF_EXECUTED_Bitmap_Operator_OPERATORS\n$NUMBER_OF_ABORTED_COLUMN_CONSTANT_FILTER_OPERATORS\t$NUMBER_OF_EXECUTED_COLUMN_CONSTANT_FILTER_OPERATORS\n$NUMBER_OF_ABORTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\t$NUMBER_OF_EXECUTED_CONVERT_BITMAP_TO_POSITIONLIST_OPERATORS\n$NUMBER_OF_ABORTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\t$NUMBER_OF_EXECUTED_CONVERT_POSITIONLIST_TO_BITMAP_OPERATORS\n$NUMBER_OF_ABORTED_ColumnAlgebraOperation_OPERATORS\t$NUMBER_OF_EXECUTED_ColumnAlgebraOperation_OPERATORS\n$NUMBER_OF_ABORTED_Column_Fetch_Join_OPERATORS\t$NUMBER_OF_EXECUTED_Column_Fetch_Join_OPERATORS\n$NUMBER_OF_ABORTED_Fetch_Join_OPERATORS\t$NUMBER_OF_EXECUTED_Fetch_Join_OPERATORS\n$NUMBER_OF_ABORTED_GPU_Groupby_Algorithm_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_Groupby_Algorithm_OPERATORS\n$NUMBER_OF_ABORTED_GPU_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_OPERATORS\n$NUMBER_OF_ABORTED_GPU_Sort_Algorithm_OPERATORS\t$NUMBER_OF_EXECUTED_GPU_Sort_Algorithm_OPERATORS\n$NUMBER_OF_ABORTED_PositionList_Operator_OPERATORS\t$NUMBER_OF_EXECUTED_PositionList_Operator_OPERATORS\n$NUMBER_OF_ABORTED_SELECTION_OPERATORS\t$NUMBER_OF_EXECUTED_SELECTION_OPERATORS" > number_of_aborted_and_executed_gpu_operators.txt
		
		for i in {0..12}; do echo $i; done > linenumbers
		paste linenumbers number_of_aborted_and_executed_gpu_operators.txt > number_of_aborted_and_executed_gpu_operators.csv
		
		WORKLOAD_EXECUTION_TIME=`cat "cogadb_ssb_measurement.log" | grep "WORKLOAD EXECUTION TIME" | awk '{print $4}' | sed -e 's/ms//g' | sed -e 's/,.*//g'` 
		TOTAL_CPU_TIME=`cat "cogadb_ssb_measurement.log" | grep "TOTAL CPU TIME" | awk '{print $4}' | sed -e 's/ms//g' | sed -e 's/,.*//g'` 
                LOAD_BALANCING_STRATEGY=`cat "cogadb_ssb_measurement.log" | grep "LOAD_BALANCING_STRATEGY" | awk '{print $2}'`
                USE_MEMORY_COST_MODELS=`cat "cogadb_ssb_measurement.log" | grep "USE_MEMORY_COST_MODELS" | awk '{print $2}'`
                QUERY_OPTIMIZER_MODE=`cat "cogadb_ssb_measurement.log" | grep "QUERY_OPTIMIZER_MODE" | awk '{print $2}'`
		WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS=`cat "cogadb_ssb_measurement.log" | grep "TOTAL_LOST_TIME_IN_NS_DUE_TO_ABORTED_GPU_OPERATORS" | awk '{print $2}' | sed -e 's/ms//g' | sed -e 's/,.*//g'`

		if [ -z $WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS ];then
		    WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS=0
		fi
		
		if [ $NUMBER_OF_EXECUTED_GPU_OPERATORS -gt 0 ]; then
		    float_eval "$NUMBER_OF_ABORTED_GPU_OPERATORS/$NUMBER_OF_EXECUTED_GPU_OPERATORS"  > abortion_rate
		else
		    echo "0" > abortion_rate
		fi
		echo 0 > null
		paste null abortion_rate > abortion_rate.csv
		
		echo $WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS > WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS
		paste null WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS > WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS.csv
		
		GPU_COLUMN_CACHE_ACCESS=`cat "cogadb_ssb_measurement.log" | grep "GPU_COLUMN_CACHE_ACCESS" | awk '{print $2}'`
		GPU_COLUMN_CACHE_HIT=`cat "cogadb_ssb_measurement.log" | grep "GPU_COLUMN_CACHE_HIT" | awk '{print $2}'`
		GPU_COLUMN_CACHE_MISS=`cat "cogadb_ssb_measurement.log" | grep "GPU_COLUMN_CACHE_MISS" | awk '{print $2}'`
		GPU_JOIN_INDEX_CACHE_ACCESS=`cat "cogadb_ssb_measurement.log" | grep "GPU_JOIN_INDEX_CACHE_ACCESS" | awk '{print $2}'`
		GPU_JOIN_INDEX_CACHE_HIT=`cat "cogadb_ssb_measurement.log" | grep "GPU_JOIN_INDEX_CACHE_HIT" | awk '{print $2}'`
		GPU_JOIN_INDEX_CACHE_MISS=`cat "cogadb_ssb_measurement.log" | grep "GPU_JOIN_INDEX_CACHE_MISS" | awk '{print $2}'`

		if [ -z $GPU_COLUMN_CACHE_ACCESS ];then
		    GPU_COLUMN_CACHE_ACCESS=0
		fi
		if [ -z $GPU_COLUMN_CACHE_HIT ];then
		    GPU_COLUMN_CACHE_HIT=0
		fi
		if [ -z $GPU_COLUMN_CACHE_MISS ];then
		    GPU_COLUMN_CACHE_MISS=0
		fi
		if [ -z $GPU_JOIN_INDEX_CACHE_ACCESS ];then
		    GPU_JOIN_INDEX_CACHE_ACCESS=0
		fi
		if [ -z $GPU_JOIN_INDEX_CACHE_HIT ];then
		    GPU_JOIN_INDEX_CACHE_HIT=0
		fi
		if [ -z $GPU_JOIN_INDEX_CACHE_MISS ];then
		    GPU_JOIN_INDEX_CACHE_MISS=0
		fi

		GPU_CACHE_COLUMN_MISSRATE=$(float_eval $GPU_COLUMN_CACHE_MISS/$GPU_COLUMN_CACHE_ACCESS)		
		GPU_CACHE_JOIN_INDEX_MISSRATE=$(float_eval $GPU_JOIN_INDEX_CACHE_MISS/$GPU_JOIN_INDEX_CACHE_ACCESS)
		

		echo -e "$GPU_CACHE_COLUMN_MISSRATE\t$GPU_CACHE_JOIN_INDEX_MISSRATE\t$GPU_COLUMN_CACHE_ACCESS\t$GPU_COLUMN_CACHE_HIT\t$GPU_COLUMN_CACHE_MISS\t$GPU_JOIN_INDEX_CACHE_ACCESS\t$GPU_JOIN_INDEX_CACHE_HIT\t$GPU_JOIN_INDEX_CACHE_MISS" > gpu_cache_statistics.csv

		POSITIONLIST_TRANSFERRED_BYTES_DEVICE_TO_HOST=`cat "cogadb_ssb_measurement.log" | grep "POSITIONLIST_TRANSFERRED_BYTES_DEVICE_TO_HOST" | awk '{print $2}'`
		POSITIONLIST_TRANSFERRED_BYTES_HOST_TO_DEVICE=`cat "cogadb_ssb_measurement.log" | grep "POSITIONLIST_TRANSFERRED_BYTES_HOST_TO_DEVICE" | awk '{print $2}'`
		TOTAL_TRANSFERRED_BYTES_DEVICE_TO_HOST=`cat "cogadb_ssb_measurement.log" | grep "TOTAL_TRANSFERRED_BYTES_DEVICE_TO_HOST" | awk '{print $2}'`
		TOTAL_TRANSFERRED_BYTES_HOST_TO_DEVICE=`cat "cogadb_ssb_measurement.log" | grep "TOTAL_TRANSFERRED_BYTES_HOST_TO_DEVICE" | awk '{print $2}'`
		TRANSFERRED_BYTES_FOR_JOIN_INDEXES_HOST_TO_DEVICE=`cat "cogadb_ssb_measurement.log" | grep "TRANSFERRED_BYTES_FOR_JOIN_INDEXES_HOST_TO_DEVICE" | awk '{print $2}'`
		BITMAP_TRANSFERRED_BYTES_DEVICE_TO_HOST=`cat "cogadb_ssb_measurement.log" | grep "BITMAP_TRANSFERRED_BYTES_DEVICE_TO_HOST" | awk '{print $2}'`
		BITMAP_TRANSFERRED_BYTES_HOST_TO_DEVICE=`cat "cogadb_ssb_measurement.log" | grep "BITMAP_TRANSFERRED_BYTES_HOST_TO_DEVICE" | awk '{print $2}'`
		COLUMN_TRANSFERRED_BYTES_DEVICE_TO_HOST=`cat "cogadb_ssb_measurement.log" | grep "COLUMN_TRANSFERRED_BYTES_DEVICE_TO_HOST" | awk '{print $2}'`
		COLUMN_TRANSFERRED_BYTES_HOST_TO_DEVICE=`cat "cogadb_ssb_measurement.log" | grep "COLUMN_TRANSFERRED_BYTES_HOST_TO_DEVICE" | awk '{print $2}'`
                
#		echo -e "$TOTAL_TRANSFERRED_BYTES_HOST_TO_DEVICE\t$TOTAL_TRANSFERRED_BYTES_DEVICE_TO_HOST\t$POSITIONLIST_TRANSFERRED_BYTES_HOST_TO_DEVICE\t$POSITIONLIST_TRANSFERRED_BYTES_DEVICE_TO_HOST\t$BITMAP_TRANSFERRED_BYTES_HOST_TO_DEVICE\t$BITMAP_TRANSFERRED_BYTES_DEVICE_TO_HOST\t$COLUMN_TRANSFERRED_BYTES_HOST_TO_DEVICE\t$COLUMN_TRANSFERRED_BYTES_DEVICE_TO_HOST\t$TRANSFERRED_BYTES_FOR_JOIN_INDEXES_HOST_TO_DEVICE" > transferred_bytes_over_pcie_bus.txt
		
		echo -e "$TOTAL_TRANSFERRED_BYTES_HOST_TO_DEVICE\n$TOTAL_TRANSFERRED_BYTES_DEVICE_TO_HOST\n$POSITIONLIST_TRANSFERRED_BYTES_HOST_TO_DEVICE\n$POSITIONLIST_TRANSFERRED_BYTES_DEVICE_TO_HOST\n$BITMAP_TRANSFERRED_BYTES_HOST_TO_DEVICE\n$BITMAP_TRANSFERRED_BYTES_DEVICE_TO_HOST\n$COLUMN_TRANSFERRED_BYTES_HOST_TO_DEVICE\n$COLUMN_TRANSFERRED_BYTES_DEVICE_TO_HOST\n$TRANSFERRED_BYTES_FOR_JOIN_INDEXES_HOST_TO_DEVICE" > transferred_bytes_over_pcie_bus.txt   
		
		for i in {0..8}; do echo $i; done > linenumbers
		paste linenumbers transferred_bytes_over_pcie_bus.txt  > transferred_bytes_over_pcie_bus.csv
		    
                
		QUERY_RUNTIMES=cogascript_timings.log
		
		#compute minimal, maximal, and average query execution time in one run as well as the variance in execution time
		cat "$QUERY_RUNTIMES" | awk '{print $2}' | sed -e 's/\./,/g' -e 's/,.*//g' -e 's/ms//g' > tmp
		QUERY_EXECUTION_STATISTICS=`cat tmp | awk -f $SCRIPT_DIR/compute_average.awk`
		rm tmp
		
		#echo -e "$SCALE_FACTOR\t$QUERY_NAME\t$NUMBER_OF_USERS\t$NUMBER_OF_QUERIES\t$NUMBER_OF_CPUS\t$NUMBER_OF_GPUS\t$LOAD_BALANCING_STRATEGY\t$QUERY_OPTIMIZER_MODE\t$USE_MEMORY_COST_MODELS\t$NUMBER_OF_EXECUTED_GPU_OPERATORS\t$NUMBER_OF_ABORTED_GPU_OPERATORS\t$WORKLOAD_EXECUTION_TIME\t$TOTAL_CPU_TIME\t$WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS\t$QUERY_EXECUTION_STATISTICS" >> measured_variables.csv
		echo -e "$NUMBER_OF_EXECUTED_GPU_OPERATORS\t$NUMBER_OF_ABORTED_GPU_OPERATORS\t$WORKLOAD_EXECUTION_TIME\t$TOTAL_CPU_TIME\t$WASTED_TIME_DUE_TO_ABORTED_GPU_OPERATORS\t$QUERY_EXECUTION_STATISTICS" > measured_variables.csv
		
		echo "$WORKLOAD_EXECUTION_TIME" > workload_execution_time_in_ms.txt
		
		TOTAL_LOST_TIME_DUE_TO_DELAYED_SCHEDULING_IN_SECONDS=$(cat "cogadb_ssb_measurement.log" | grep "TOTAL_LOST_TIME_DUE_TO_DELAYED_SCHEDULING_IN_SECONDS" | awk '{print $2}')
		if [ -z $TOTAL_LOST_TIME_DUE_TO_DELAYED_SCHEDULING_IN_SECONDS ]; then
		    TOTAL_LOST_TIME_DUE_TO_DELAYED_SCHEDULING_IN_SECONDS=0
		fi
		
		echo "$TOTAL_LOST_TIME_DUE_TO_DELAYED_SCHEDULING_IN_SECONDS" > total_lost_time_due_to_sched_delays_in_sec.txt

		
		exit 0
